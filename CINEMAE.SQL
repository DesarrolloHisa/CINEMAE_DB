CREATE DATABASE CINEMAE
GO

USE CINEMAE
GO

CREATE TABLE PRODUCTO
(ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
NOMBRE NVARCHAR(30) NOT NULL,
DESCRIPCION NVARCHAR(30) NOT NULL,
PRECIO MONEY NOT NULL)

CREATE TABLE SEDE
(ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
NOMBRE NVARCHAR(30) NOT NULL,
DIRECCION NVARCHAR(30) NOT NULL)

CREATE TABLE CONFITERIA
(ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
ID_SEDE INT NOT NULL,
TELEFONO NVARCHAR(10) NOT NULL
FOREIGN KEY (ID_SEDE) REFERENCES SEDE(ID))

CREATE TABLE CONFIRTERIA_PRODUCTO
(ID_PRODUCTO INT NOT NULL,
ID_CONFITERIA INT NOT NULL,
PRIMARY KEY (ID_PRODUCTO, ID_CONFITERIA),
FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTO(ID),
FOREIGN KEY (ID_CONFITERIA) REFERENCES CONFITERIA(ID))

CREATE TABLE FACTURA
(ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
ID_CONFITERIA INT NOT NULL,
FECHA DATE NOT NULL,
TIPO NVARCHAR(30) NOT NULL,
ESTADO NVARCHAR(15) NOT NULL,--
IVA MONEY NOT NULL,
TOTAL MONEY NOT NULL,
FOREIGN KEY (ID_CONFITERIA) REFERENCES CONFITERIA(ID))

CREATE TABLE PELICULA
(ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
NOMBRE NVARCHAR(30) NOT NULL,
DURACION FLOAT NOT NULL,
DIRECTOR NVARCHAR(30) NOT NULL)

CREATE TABLE CARTELERA
(ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
ID_PELICULA INT NOT NULL,
FECHA DATE NOT NULL,
HORA TIME NOT NULL,
PRECIO MONEY NOT NULL,
FOREIGN KEY (ID_PELICULA) REFERENCES PELICULA(ID))

CREATE TABLE SALA
(ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
ID_SALA INT NOT NULL,
ID_CARTELERA INT NOT NULL,
ASIENTOS INT NOT NULL,--
FOREIGN KEY (ID_SALA) REFERENCES SEDE(ID),
FOREIGN KEY (ID_CARTELERA) REFERENCES CARTELERA(ID))


INSERT INTO PRODUCTO (NOMBRE, DESCRIPCION, PRECIO)
VALUES ('Crispetas', 'Deliciosas crispetas', 12.999),
       ('Combo 2', 'Perro y gaseosa', 15.999),
       ('Combo 3', 'Crispetas medianas', 12.999),
	   ('Combo 4', 'Crispetas grandes', 17.999),
	   ('Combo 5', 'Ice', 10.999);

INSERT INTO SEDE (NOMBRE, DIRECCION)
VALUES ('Sede 1', 'Palmas'),
       ('Sede 2', 'Manrique'),
       ('Sede 3', 'Laureles'),
	   ('Sede 4', 'San Javier'),
	   ('Sede 5', 'Bello');

INSERT INTO CONFITERIA (ID_SEDE, TELEFONO)
VALUES (1, '1234567890'),
       (2, '0987654321'),
       (3, '9876543210'),
	   (4, '310213324'),
	   (5, '3234323532');

INSERT INTO CONFIRTERIA_PRODUCTO (ID_PRODUCTO, ID_CONFITERIA)
VALUES (4, 1),
       (5, 2),
       (6, 3);

INSERT INTO FACTURA (ID_CONFITERIA, FECHA, TIPO, ESTADO, IVA, TOTAL)
VALUES (1, '2023-05-01', 'Online', 'Pagado', 0.21, 50.999),
       (2, '2023-05-02', 'Sede', 'Deuda', 0.21, 75.550),
       (3, '2023-05-03', 'Online', 'Deuda', 0.21, 120.754);


INSERT INTO PELICULA (NOMBRE, DURACION, DIRECTOR)
VALUES ('Mario', 120, 'Enrique segoviano'),
       ('Avengers', 150, 'Mateo'),
       ('Pantera rosa 3D', 110, 'Jeffrey'),
	   ('Superman', 40, 'Enrique segoviano'),
	   ('Casa de papel', 110, 'Jeffrey'),
	   ('Dueño del mundo', 150, 'Mateo');

INSERT INTO CARTELERA (ID_PELICULA, FECHA, HORA, PRECIO)
VALUES (1, '2023-05-01', '12:00:00', 14.000),
       (2, '2023-05-02', '15:00:00', 10.000),
       (3, '2023-05-03', '18:00:00', 20.000),
	   (4, '2023-05-04', '20:00:00', 21.000),
	   (5, '2023-05-05', '18:30:00', 22.000);


INSERT INTO SALA (ID_SALA, ID_CARTELERA, ASIENTOS)
VALUES (1, 1, 40),
       (2, 2, 25),
       (3, 3, 12),
	   (4, 4, 10),
	   (5, 5, 20),
	   (6, 5, 120),
	   (7, 4, 110);



---------------
--Productos con precio mayor a $13.000--
CREATE VIEW PrecioMayor AS
SELECT * FROM PRODUCTO WHERE PRECIO > 13.000;

--Sedes con dirección igual a palmas--
CREATE VIEW SedePalmas AS
SELECT * FROM SEDE WHERE DIRECCION = 'Palmas';

--Facturas con estado Pagada--
CREATE VIEW FacturaPaga AS
SELECT * FROM FACTURA WHERE ESTADO = 'Pagado';

--Películas con duración mayor a 2h y 10min horas--
CREATE VIEW PeliculasDuracion AS
SELECT * FROM PELICULA WHERE DURACION > 130;

--Carteleras para una fecha específica--
CREATE VIEW CarteleraFecha AS
SELECT * FROM CARTELERA WHERE FECHA = '2023-05-05';

--Salas con más de 100 asientos--
CREATE VIEW AsientosSalas AS
SELECT * FROM SALA WHERE ASIENTOS > 100;

--Películas dirigidas por Enrique segoviano--
CREATE VIEW PeliculaEnrique AS
SELECT * FROM PELICULA WHERE DIRECTOR = 'Enrique segoviano';

--Facturas con total mayor a 100.000--
CREATE VIEW FacturaTotal AS
SELECT * FROM FACTURA WHERE TOTAL > 100.000;

--Películas con duración entre 90 y 120 minutos--
CREATE VIEW DuracionPeli AS
SELECT * FROM PELICULA WHERE DURACION BETWEEN 90 AND 120;

--Salas con más de 20 asientos disponibles--
CREATE VIEW SalasAsientos AS
SELECT * FROM SALA WHERE ASIENTOS > 20;

--Facturas de tipo 'Online' y 'Pagada'--
CREATE VIEW FacturaOnline AS
SELECT * FROM FACTURA WHERE TIPO = 'Online' AND ESTADO = 'Pagado';